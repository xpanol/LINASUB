<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Karaoke — Linia po linii</title>

<link href="https://fonts.googleapis.com/css2?family=Special+Elite&display=swap" rel="stylesheet">

<style>
  :root{
    --highlight: #F6B511;
    --bg-dim: 0.55;
    --font: "Special Elite", monospace;
  }

  html,body{
    margin:0;
    padding:0;
  }

  body{
    font-family: var(--font);
    background:#000;
    color:#fff;
    display:flex;
    align-items:center;
    justify-content:center;
    min-height:100vh;
    padding:20px;
    box-sizing:border-box;
  }

  @media (max-width:600px){
    body{
      padding:20px;
    }
  }

  .background{
    position:fixed;
    inset:0;
    background-image:url('BACKGROUND.jpg');
    background-size:cover;
    background-position:center;
    filter:brightness(calc(1 - var(--bg-dim)));
    z-index:-1;
  }

  .app {
    width:100%;
    max-width:1000px;
    max-height:calc(100vh - 40px);
    overflow:auto;
    text-align:center;
    padding:10px;
    box-sizing:border-box;
  }

  .line-box {
    min-height:120px;
    margin:0 auto 18px;
    padding:18px;
    background:rgba(0,0,0,0.25);
    border-radius:10px;
    box-shadow:0 6px 24px rgba(0,0,0,0.5);
  }

  .line {
    font-size:24px;
    line-height:1.45;
    margin:12px 0;
    text-shadow:0 2px 6px rgba(0,0,0,0.8);
  }

  .word { transition: color 0.12s ease; }
  .word.highlight { color: var(--highlight); font-weight:700; }

  .controls {
    display:flex;
    flex-direction:row;
    gap:12px;
    justify-content:center;
    align-items:center;
    margin-top:6px;
    flex-wrap:nowrap;
  }

  .btn {
    background:var(--highlight);
    color:#000;
    border:0;
    padding:10px 16px;
    border-radius:8px;
    font-family:var(--font);
    font-size:16px;
    cursor:pointer;
    white-space:nowrap;
  }

  .btn:active { transform:translateY(1px); }

  @media (max-width:600px){
    .line { font-size:20px; }
    .line-box { padding:14px; min-height:110px; }
  }
</style>
</head>

<body>
  <div class="background" aria-hidden="true"></div>

  <div class="app" role="application" aria-label="Karaoke">
    <div class="line-box" id="lineBox" aria-live="polite"></div>

    <div class="controls" role="toolbar">
      <button class="btn" id="backBtn">Back</button>
      <button class="btn" id="playBtn">Play</button>
      <button class="btn" id="restartBtn">Restart</button>
    </div>
  </div>

  <audio id="audio" src="LINA_XPANOL.mp3" autoplay></audio>

<script>
const JSON_FILES = ['LINA_XPANOL.json'];

const audio = document.getElementById('audio');
const lineBox = document.getElementById('lineBox');
const playBtn = document.getElementById('playBtn');
const backBtn = document.getElementById('backBtn');
const restartBtn = document.getElementById('restartBtn');

let blockSize = 2;
let rawData = null;
let lines = [];
let blocks = [];
let currentBlockIndex = 0;
let rafId = null;

async function loadJsonTry(files){
  for(const f of files){
    try{
      const resp = await fetch(f);
      if(!resp.ok) continue;
      const data = await resp.json();
      return data;
    }catch(e){}
  }
  throw new Error('Nie można wczytać JSON.');
}

function normalizeData(data){
  if(!Array.isArray(data)) throw new Error('JSON musi być tablicą');
  if(data.length === 0) return [];

  if(data[0].line || data[0].words){
    return data.map(item => {
      const words = (item.words || []).map(w => ({
        text: w.text,
        start: Number(w.start),
